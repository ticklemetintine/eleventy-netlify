var data = [
  {
    "returns"  : -105,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : -95,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : -85,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : -75,
    "central"  : 0.00,
    "china"    : 0.01,
    "secular"   : 0.01,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : -65,
    "central"  : 0.01,
    "china"    : 0.05,
    "secular"   : 0.15,
    "severe"   : 0.02,
    "ccla"   : 0.02,
    "ccha"   : 0.01
  },
  {
    "returns"  : -55,
    "central"  : 0.07,
    "china"    : 0.31,
    "secular"   : 0.52,
    "severe"   : 0.12,
    "ccla"   : 0.10,
    "ccha"   : 0.07
  },
  {
    "returns"  : -45,
    "central"  : 0.56,
    "china"    : 0.12,
    "secular"   : 1.34,
    "severe"   : 0.85,
    "ccla"   : 0.67,
    "ccha"   : 0.56
  },
  {
    "returns"  : -35,
    "central"  : 2.31,
    "china"    : 3.17,
    "secular"   : 3.60,
    "severe"   : 3.12,
    "ccla"   : 2.62,
    "ccha"   : 2.25
  },
  {
    "returns"  : -25,
    "central"  : 6.44,
    "china"    : 7.04,
    "secular"   : 7.58,
    "severe"   : 7.49,
    "ccla"   : 6.92,
    "ccha"   : 6.30
  },
  {
    "returns"  : -15,
    "central"  : 12.03,
    "china"    : 12.36,
    "secular"   : 12.93,
    "severe"   : 13.14,
    "ccla"   : 12.65,
    "ccha"   : 11.85
  },
  {
    "returns"  : -5,
    "central"  : 16.99,
    "china"    : 16.56,
    "secular"   : 17.07,
    "severe"   : 17.27,
    "ccla"   : 17.26,
    "ccha"   : 16.65
  },
  {
    "returns"  : 5,
    "central"  : 18.22,
    "china"    : 17.81,
    "secular"   : 17.76,
    "severe"   : 18.19,
    "ccla"   : 18.08,
    "ccha"   : 18.09
  },
  {
    "returns"  : 15,
    "central"  : 15.98,
    "china"    : 15.37,
    "secular"   : 14.89,
    "severe"   : 15.15,
    "ccla"   : 15.56,
    "ccha"   : 16.02
  },
  {
    "returns"  : 25,
    "central"  : 11.69,
    "china"    : 11.25,
    "secular"   : 10.64,
    "severe"   : 10.81,
    "ccla"   : 11.29,
    "ccha"   : 12.37
  },
  {
    "returns"  : 35,
    "central"  : 7.51,
    "china"    : 7.37,
    "secular"   : 6.57,
    "severe"   : 6.82,
    "ccla"   : 7.15,
    "ccha"   : 8.17
  },
  {
    "returns"  : 45,
    "central"  : 4.18,
    "china"    : 3.84,
    "secular"   : 3.53,
    "severe"   : 3.62,
    "ccla"   : 3.88,
    "ccha"   : 4.76
  },
  {
    "returns"  : 55,
    "central"  : 2.06,
    "china"    : 1.92,
    "secular"   : 1.71,
    "severe"   : 1.78,
    "ccla"   : 1.95,
    "ccha"   : 2.18
  },
  {
    "returns"  : 65,
    "central"  : 0.99,
    "china"    : 0.97,
    "secular"   : 0.87,
    "severe"   : 0.83,
    "ccla"   : 0.96,
    "ccha"   : 1.06
  },
  {
    "returns"  : 75,
    "central"  : 0.50,
    "china"    : 0.46,
    "secular"   : 0.43,
    "severe"   : 0.42,
    "ccla"   : 0.45,
    "ccha"   : 0.54
  },
  {
    "returns"  : 85,
    "central"  : 0.24,
    "china"    : 0.21,
    "secular"   : 0.20,
    "severe"   : 0.20,
    "ccla"   : 0.23,
    "ccha"   : 0.24
  },
  {
    "returns"  : 95,
    "central"  : 0.10,
    "china"    : 0.09,
    "secular"   : 0.09,
    "severe"   : 0.09,
    "ccla"   : 0.10,
    "ccha"   : 0.12
  },
  {
    "returns"  : 105,
    "central"  : 0.05,
    "china"    : 0.04,
    "secular"   : 0.04,
    "severe"   : 0.04,
    "ccla"   : 0.05,
    "ccha"   : 0.05
  },
  {
    "returns"  : 115,
    "central"  : 0.03,
    "china"    : 0.03,
    "secular"   : 0.03,
    "severe"   : 0.02,
    "ccla"   : 0.03,
    "ccha"   : 0.04
  },
  {
    "returns"  : 125,
    "central"  : 0.02,
    "china"    : 0.01,
    "secular"   : 0.02,
    "severe"   : 0.01,
    "ccla"   : 0.01,
    "ccha"   : 0.02
  },
  {
    "returns"  :135,
    "central"  : 0.01,
    "china"    : 0.00,
    "secular"   : 0.01,
    "severe"   : 0.01,
    "ccla"   : 0.01,
    "ccha"   : 0.01
  },
  {
    "returns"  : 145,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : 155,
    "central"  : 0.01,
    "china"    : 0.00,
    "secular"   : 0.01,
    "severe"   : 0.01,
    "ccla"   : 0.01,
    "ccha"   : 0.01
  },
  {
    "returns"  : 165,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : 175,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : 185,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : 195,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : 205,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  },
  {
    "returns"  : 215,
    "central"  : 0.00,
    "china"    : 0.00,
    "secular"   : 0.00,
    "severe"   : 0.00,
    "ccla"   : 0.00,
    "ccha"   : 0.00
  }
]

var tgem4AssetPath = "/ed/t-gem-chart4/zh/";
// var tgem4AssetPath = "./";

var chart4ColorChina      = "#D50065";
var chart4ColorSecular     = "#12A639";
var chart4ColorCentral    = "#49176D";
var chart4ColorSevere   = "rgb(0, 85, 164)";
var chart4ColorCCLA     = "rgb(250, 182, 0)"; //Climate Change Low Ambition
var chart4ColorCCHA     = "rgb(149, 186, 41)"; //Climate Change High Ambition

var width = 900, height = 250;

var chart4x = d3.scaleLinear().range([0, width]);
var chart4y = d3.scaleLinear().range([height, 0]);

var chart4XAxis = d3.axisBottom()
  .scale(chart4x)
  .tickFormat(function(d) {
   if (d == 0) {
        return d;
   }
  })
  .tickValues([-80,-60,-40,-20,0,20,40,60,80]);

var chart4YAxis = d3.axisLeft()
    .scale(chart4y)
    .tickFormat(function(d) {
      return "";
    })
    .tickSize(0);

d3.select(window).on("resize", resize);

var chart4svg = d3.select("#chart_tgem4")
              .append("div")
              .classed("ed-container", true) //container class to make it responsive
              .append("div")
              .classed("ed-svg-container", true) //container class to make it responsive
              .append("svg")
              .attr("preserveAspectRatio", "xMinYMin meet")
              .attr("viewBox", "0 0 " + (width+100) + " "  + (height+200))
              .classed("ed-svg-content-responsive", true)
              .append("g")
    .attr("transform", "translate(" + 50 + "," + 20 + ")");

var chart4LineCentral = d3.line()
    //.interpolate("basis")
    .x(function(d) { return chart4x(d.returns); })
    .y(function(d) { return chart4y(d.central); })
    .curve(d3.curveBasis);

var chart4LineSevere = d3.line()
    //.interpolate("basis")
    .x(function(d) { return chart4x(d.returns); })
    .y(function(d) { return chart4y(d.severe); })
    .curve(d3.curveBasis);

var chart4LineChina = d3.line()
    //.interpolate("basis")
    .x(function(d) { return chart4x(d.returns); })
    .y(function(d) { return chart4y(d.china); })
    .curve(d3.curveBasis);

var chart4LineSecular = d3.line()
    //.interpolate("basis")
    .x(function(d) { return chart4x(d.returns); })
    .y(function(d) { return chart4y(d.secular); })
    .curve(d3.curveBasis);

var chart4LineCCLA = d3.line()
    //.interpolate("basis")
    .x(function(d) { return chart4x(d.returns); })
    .y(function(d) { return chart4y(d.ccla); })
    .curve(d3.curveBasis);


var chart4LineCCHA = d3.line()
    //.interpolate("basis")
    .x(function(d) { return chart4x(d.returns); })
    .y(function(d) { return chart4y(d.ccha); })
    .curve(d3.curveBasis);

  data.forEach(function(d) {
    d.returns = +d.returns;
    d.central = +d.central;
    d.secular = +d.secular;
    d.china = +d.china;
    d.severe = +d.severe;
    d.ccla =+d.ccla;
    d.ccha =+d.ccha;
  });

  chart4x.domain([
    d3.min(data, function(d) { return -80; }),
    d3.max(data, function(d) { return 80; })
  ]);

  var maxY = d3.max(data, function(d) { return Math.max(d.central, d.secular, d.china,d.severe,d.ccha,d.ccla); })
  var maxTemasekY = d3.max(data, function(d) { return d.central; });

  chart4y.domain([
    d3.min(data, function(d) {
      return Math.min(d.central, d.secular, d.china,d.severe,d.ccha,d.ccla);
    }),
    maxTemasekY / 0.48
  ]);

  chart4svg.datum(data);

  chart4svg.append("clipPath")
    .attr("id", "chart4MaskClip1")
    .append("rect")
    .attr("width", 0)
    .attr("height", height);

  chart4svg.append("clipPath")
    .attr("id", "chart4MaskVisible")
    .append("rect")
        .attr("x", 0)
    .attr("width", width)
    .attr("height", height);

  chart4svg.append("line")
    .style("stroke", "black")
    .style("stroke-dasharray", ("3, 3"))
    .attr("x1", chart4x(0))     // chart4x position of the first end of the line
    .attr("y1", chart4y(0))      // y position of the first end of the line
    .attr("x2", chart4x(0))     // x position of the second end of the line
    .attr("y2", 0);    // y position of the second end of the line

  // ==============================



  var cchaPath= chart4svg.append("path")
      .attr("id", "chart4CCHAGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorCCHA)
      .attr("stroke-width", 3)
      .attr("d", chart4LineCCHA)
      .attr("clip-path", "url(#chart4MaskVisible)");

  var cclaPath= chart4svg.append("path")
      .attr("id", "chart4CCLAGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorCCLA)
      .attr("stroke-width", 3)
      .attr("d", chart4LineCCLA)
      .attr("clip-path", "url(#chart4MaskVisible)");

 var secularPath= chart4svg.append("path")
      .attr("id", "chart4SecularGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorSecular)
      .attr("stroke-width", 3)
      .attr("d", chart4LineSecular)
      .attr("clip-path", "url(#chart4MaskVisible)");


  var severePath= chart4svg.append("path")
      .attr("id", "chart4SevereGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorSevere)
      .attr("stroke-width", 3)
      .attr("d", chart4LineSevere)
      .attr("clip-path", "url(#chart4MaskVisible)");


  var chinaPath=chart4svg.append("path")
      .attr("id", "chart4ChinaGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorChina)
      .attr("d", chart4LineChina)
      //.style("stroke-dasharray", ("11, 12"))
      .attr("stroke-width", 3)
      .attr("clip-path", "url(#chart4MaskVisible)");

  var centralPath=chart4svg.append("path")
      .attr("id", "chart4CentralGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorCentral)
      //.style("stroke-dasharray", ("4, 4"))
      .attr("stroke-width", 5)
      .attr("d", chart4LineCentral)
      .attr("clip-path", "url(#chart4MaskVisible)");

      transitionFunc(centralPath,0);
      transitionDashFunc(chinaPath,2000,4,4);
      transitionDashFunc(severePath,4000,9,6);
      transitionDashFunc(secularPath,6000,9,6);
      transitionDashFunc(cclaPath,8000,4,4);
      transitionDashFunc(cchaPath,10000,9,6);

  chart4ShowToolTipA();

  chart4svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(chart4XAxis)
  chart4svg.append("g")
  .attr("transform", "translate(0," + height + ")")
    .append("text")
      .attr("y", 45)
      .attr("x", width/2 - 10)
      .attr("class", "light")
      .style("text-anchor", "middle")
      .text("20年期间年度同比回报 (%)");

  chart4svg.append("g")
      .attr("class", "y axis")
      .call(chart4YAxis)
  // chart4svg.append("g")
  //   .append("text")
  //     .attr("transform", "rotate(-90)")
  //     .attr("y", -18)
  //     .attr("dy", ".71em")
  //     .attr("x", -height/2 + 20)
  //     .style("text-anchor", "middle")
  //     .text("相对可能性");

  var Yaxis_label="相对几率";
  //created a function to draw each letter vertically on Y axis
   var DrawYaxis=function(Yaxis_label){
      for(var i=0;i<Yaxis_label.length;i++){
        chart4svg.append("g")
        .append("text")
        .attr("y", (height/2)+(i*15))
        .attr("dy", -15)
        .attr("x", -17)
        .style("text-anchor", "middle")
        .text(Yaxis_label[i]);
      }
  }

    //calling that function
    DrawYaxis(Yaxis_label);

    setTimeout(function() {
      d3.select("#chart4MaskClip1 rect")
        .transition().duration(1200)
        .attr("width", width);
    }, 0);


addTickMargin();


chart4svg.append("line")
  .attr("id", "chart4CCLALine")
  .style("stroke", chart4ColorCCLA)
  .attr("stroke-width", 3)
  .attr("stroke-dasharray", ("4, 4"))
  .attr("x1", 245)     // x position of the first end of the line
  .attr("y1", height + 85)      // y position of the first end of the line
  .attr("x2", 275)     // x position of the second end of the line
  .attr("y2", height + 85);    // y position of the second end of the line
chart4svg.append("text")
  .text("缺乏决心应对气候变化")
  // .style("stroke", chart4ColorCentral)
  .attr("x", 278)
  .attr("y", height + 90)
  .on('click', chart4OnClickLegendCCLA);

// CCHA
chart4svg.append("line")
  .attr("id", "chart4CCHALine")
  .style("stroke", chart4ColorCCHA)
  .attr("stroke-width", 3)
  .attr("stroke-dasharray", ("9, 6"))
  .attr("x1", 525)     // x position of the first end of the line
  .attr("y1", height + 85)      // y position of the first end of the line
  .attr("x2", 555)     // x position of the second end of the line
  .attr("y2", height + 85);    // y position of the second end of the line
chart4svg.append("text")
  .text("坚定决心应对气候变化")
  // .style("stroke", chart4ColorCentral)
  .attr("x", 559)
  .attr("y", height + 90)
  .on('click', chart4OnClickLegendCCHA);


// Central
chart4svg.append("line")
  .attr("id", "chart4CentralLine")
  .style("stroke", chart4ColorCentral)
  .attr("stroke-width", 5)
  .attr("x1", 30)     // x position of the first end of the line
  .attr("y1", height + 65)      // y position of the first end of the line
  .attr("x2", 55)     // x position of the second end of the line
  .attr("y2", height + 65);    // y position of the second end of the line

chart4svg.append("text")
  .text("基准情境")
  // .style("stroke", chart4ColorCentral)
  .attr("x", 65)
  .attr("y", height + 70)
  .on('click', chart4OnClickLegendCentral);


// China Hard Landing
chart4svg.append("line")
  .attr("id", "chart4ChinaLine")
  .style("stroke", chart4ColorChina)
  .attr("stroke-width", 3)
  .style("stroke-dasharray", ("4, 4"))
  .attr("x1", 245)     // x position of the first end of the line
  .attr("y1", height + 65)      // y position of the first end of the line
  .attr("x2", 275)     // x position of the second end of the line
  .attr("y2", height + 65);    // y position of the second end of the line

chart4svg.append("text")
  .text("中国经济硬着陆")
  // .style("stroke", chart4ColorCentral)
  .attr("x", 278)
  .attr("y", height + 70)
  .on('click', chart4OnClickLegendChina);


// Severe Escalation in Trade and Tech Tensions
chart4svg.append("line")
  .attr("id", "chart4SevereLine")
  .style("stroke", chart4ColorSevere)
  .attr("stroke-width", 3)
  .style("stroke-dasharray", ("9,6"))
  .attr("x1", 525)     // x position of the first end of the line
  .attr("y1", height + 65)      // y position of the first end of the line
  .attr("x2", 550)     // x position of the second end of the line
  .attr("y2", height + 65);    // y position of the second end of the line

chart4svg.append("text")
  .text("贸易和科技紧张局势严重升级")
  // .style("stroke", chart4ColorCentral)
  .attr("x", 560)
  .attr("y", height + 70)
  .on('click', chart4OnClickLegendSevere);


// Secular Stagnation
chart4svg.append("line")
  .attr("id", "chart4SecularLine")
  .style("stroke", chart4ColorSecular)
  .attr("stroke-width", 3)
  .style("stroke-dasharray", ("9, 6"))
  .attr("x1", 30)     // x position of the first end of the line
  .attr("y1", height + 85)      // y position of the first end of the line
  .attr("x2", 55)     // x position of the second end of the line
  .attr("y2", height + 85);    // y position of the second end of the line

chart4svg.append("text")
  .text("长期滞胀")
  // .style("stroke", chart4ColorCentral)
  .attr("x", 65)
  .attr("y", height + 90)
  .on('click', chart4OnClickLegendSecular);


var chart4CentralActive = true;
function chart4OnClickLegendCentral() {
  chart4CentralActive = !chart4CentralActive;

  if (chart4CentralActive) {
    chart4svg.select("#chart4CentralLine").style("stroke", chart4ColorCentral);
    chart4svg.append("path")
      .attr("id", "chart4CentralGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorCentral)
      .attr("stroke-width", 5)
      .attr("d", chart4LineCentral)
      .attr("clip-path", "url(#chart4MaskVisible)");
      chart4ShowToolTipA();
  } else {
    chart4svg.select("#chart4CentralLine").style("stroke", "");
    chart4svg.select("#chart4CentralGraphLine").remove();
    chart4RemoveToolTipA();
  }
}

var chart4ChinaActive = true;
function chart4OnClickLegendChina() {
  chart4ChinaActive = !chart4ChinaActive;

  if (chart4ChinaActive) {
    chart4svg.select("#chart4ChinaLine")
      .style("stroke", chart4ColorChina)
      .style("stroke-dasharray", ("4, 4"));
    chart4svg.append("path")
      .attr("id", "chart4ChinaGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorChina)
      .style("stroke-dasharray", ("4, 4"))
      .attr("stroke-width", 3)
      .attr("d", chart4LineChina)
      .attr("clip-path", "url(#chart4MaskVisible)");
  } else {
    chart4svg.select("#chart4ChinaLine").style("stroke", "");
    chart4svg.select("#chart4ChinaGraphLine").remove();
  }
}

var chart4CCLAActive = true;
function chart4OnClickLegendCCLA() {
  chart4CCLAActive = !chart4CCLAActive;

  if (chart4CCLAActive) {
    chart4svg.select("#chart4CCLALine").style("stroke", chart4ColorCCLA);
    // chart4svg.select("#chart4GlobalGraphLine").style("stroke", chart4ColorGlobal);
    // text.transition().duration(1000).attr("transform", function(d) {
    //   return "translate("  + 0 + ", " + "-20" +")";
    // });
    chart4svg.append("path")
      .attr("id", "chart4CCLAGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorCCLA)
      .attr("clip-path", "url(#chart4MaskVisible)");

    chart4svg.select("#chart4CCLAGraphLine")
      .attr("d", chart4LineCCLA)
      .style("stroke-dasharray", ("4, 4"))
      .attr("stroke-width", 3);

  } else {
    chart4svg.select("#chart4CCLALine").style("stroke", "");
    chart4svg.select("#chart4CCLAGraphLine").remove();
  }
}


var chart4CCHAActive = true;
function chart4OnClickLegendCCHA() {
  chart4CCHAActive = !chart4CCHAActive;

  if (chart4CCHAActive) {
    chart4svg.select("#chart4CCHALine").style("stroke", chart4ColorCCHA);
    // chart4svg.select("#chart4GlobalGraphLine").style("stroke", chart4ColorGlobal);
    // text.transition().duration(1000).attr("transform", function(d) {
    //   return "translate("  + 0 + ", " + "-20" +")";
    // });
    chart4svg.append("path")
      .attr("id", "chart4CCHAGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorCCHA)
      .attr("clip-path", "url(#chart4MaskVisible)");

    chart4svg.select("#chart4CCHAGraphLine")
      .attr("d", chart4LineCCHA)
      .style("stroke-dasharray", ("9, 6"))
      .attr("stroke-width", 3);

  } else {
    chart4svg.select("#chart4CCHALine").style("stroke", "");
    chart4svg.select("#chart4CCHAGraphLine").remove();
  }
}



var chart4SecularActive = true;
function chart4OnClickLegendSecular() {
  chart4SecularActive = !chart4SecularActive;

  if (chart4SecularActive) {
    chart4svg.select("#chart4SecularLine").style("stroke", chart4ColorSecular);
    // chart4svg.select("#chart4SecularGraphLine").style("stroke", chart4ColorSecular);
    // text.transition().duration(1000).attr("transform", function(d) {
    //   return "translate("  + 0 + ", " + "-20" +")";
    // });
    chart4svg.append("path")
      .attr("id", "chart4SecularGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorSecular)
      .attr("clip-path", "url(#chart4MaskVisible)");

    chart4svg.select("#chart4SecularGraphLine")
      .attr("d", chart4LineSecular)
      .style("stroke-dasharray", ("9, 6"))
      .attr("stroke-width", 3);

  } else {
    chart4svg.select("#chart4SecularLine").style("stroke", "");
    chart4svg.select("#chart4SecularGraphLine").remove();
  }
}

var chart4SevereActive = true;
function chart4OnClickLegendSevere() {
  chart4SevereActive = !chart4SevereActive;

  if (chart4SevereActive) {
    chart4svg.select("#chart4SevereLine").style("stroke", chart4ColorSevere);
    chart4svg.append("path")
      .attr("id", "chart4SevereGraphLine")
      .attr("class", "line")
      .style("stroke", chart4ColorSevere)
      .attr("clip-path", "url(#chart4MaskVisible)");

    chart4svg.select("#chart4SevereGraphLine")
      .attr("d", chart4LineChina)
      .style("stroke-dasharray", ("9,6"))
      .attr("stroke-width", 3);

  } else {
    chart4svg.select("#chart4SevereLine").style("stroke", "");
    chart4svg.select("#chart4SevereGraphLine").remove();
  }
}


chart4svg.append("text")
    .attr("x", 8)
    .attr("y", height + 25)
    .text("负数")
    .style("text-anchor", "start");
chart4svg.append("text")
    .attr("x", width - 35)
    .attr("y", height + 25)
    .text("正数")
    .style("text-anchor", "start");


function chart4RemoveToolTipA() {
  chart4svg.select("#chart4TemToolTipA").remove();
  chart4svg.select("#chart4TemToolTipATextA").remove();
  chart4svg.select("#chart4TemToolTipATextB").remove();
  chart4svg.select("#chart4TemToolTipATextC").remove();
  chart4svg.select("#chart4TemToolTipATextD").remove();
}


function chart4ShowToolTipA() {
  chart4ShowToolTip({
    toolTipId: "chart4TemToolTipA",
    rectXCoor: chart4x(13),
    rectYCoor: chart4y(38.2),
    width: 200,
    textColor: "black",
    dotted: true,
    outlineColor: chart4ColorChina,
    textValueLineA: "除对比坚定决心应对",
    textValueLineB: "气候变化情境之外，",
    textValueLineC: "基准情境下获得更高",
    textValueLineD: "回报的几率略高",
    maskClipId: "chart4MaskClip1"
  });
}

function chart4ShowToolTip(params) {
  params.textValueLineD ?
    params.height = 50 + 20*2 :
    params.textValueLineC ?
      params.height = 50 + 20 :
      null;

  var aToolTip = chart4svg.append("g");
  aToolTip.append("svg:image")
    .attr("id", params.toolTipId)
    .attr("x", params.rectXCoor - 2)
    .attr("y", params.rectYCoor + 20)
    .attr("height", 126)    // set the height
    .attr("width", 185)
    .attr("xlink:href", tgem4AssetPath + "chart4-callout1-zh.png")
    .attr("clip-path", "url(#" + params.maskClipId + ")");
  aToolTip
    .append("text")
    .attr("id", params.toolTipId + "TextA")
    .attr("x", params.rectXCoor + 16)
    .attr("y", params.rectYCoor + 46)
    .text(params.textValueLineA)
    .style('fill', params.textColor)
    .style("text-anchor", "start")
    .attr("clip-path", "url(#" + params.maskClipId + ")");
  aToolTip
    .append("text")
    .attr("id", params.toolTipId + "TextB")
    .attr("x", params.rectXCoor + 16)
    .attr("y", params.rectYCoor + 66)
    .text(params.textValueLineB)
    .style('fill', params.textColor)
    .style("text-anchor", "start")
    .attr("clip-path", "url(#" + params.maskClipId + ")");
  aToolTip
    .append("text")
    .attr("id", params.toolTipId + "TextC")
    .attr("x", params.rectXCoor + 16)
    .attr("y", params.rectYCoor + 86)
    .text(params.textValueLineC)
    .style('fill', params.textColor)
    .style("text-anchor", "start")
    .attr("clip-path", "url(#" + params.maskClipId + ")");
  aToolTip
    .append("text")
    .attr("id", params.toolTipId + "TextD")
    .attr("x", params.rectXCoor + 16)
    .attr("y", params.rectYCoor + 106)
    .text(params.textValueLineD)
    .style('fill', params.textColor)
    .style("text-anchor", "start")
    .attr("clip-path", "url(#" + params.maskClipId + ")");
}

//function to give animation for each path
function transitionFunc(pathName,animationDelay) {
      var totalLength = pathName.node().getTotalLength();
      pathName
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
      .ease(d3.easeLinear)
      .duration(1500)
      .delay(animationDelay)
      .attr("stroke-dashoffset", 0);
}

function transitionDashFunc(pathName,animationDelay,dashA,dashB) {
      var totalLength = pathName.node().getTotalLength()+30;

      var dashing = (dashA + "," + dashB)

      var dashLength = dashing
                  		.split(/[\s,]/)
                  		.map(function (a) { return parseFloat(a) || 0 })
                  		.reduce(function (a, b) { return a + b });

      if(dashing=="15,10"){
          dashing = (15 + "," + 10 + "," + 5 + "," + 10 + "," + 15)
          dashLength = 50;
      }

      var dashCount = Math.ceil( totalLength / dashLength )-1;
      var newDashes = new Array(dashCount).join( dashing + " " );
      var dashArray = newDashes + " 0, " + totalLength;

            pathName
            .attr("stroke-dashoffset", totalLength)
            .attr("stroke-dasharray", dashArray)
            .transition()
            .ease(d3.easeLinear)
            .duration(1500)
            .delay(animationDelay)
            .attr("stroke-dashoffset", 0);
}

function addTickMargin(){
  d3.select('.x.axis .tick text').attr('y', 8);
}

resize();
function resize(){
  var svg = d3.select("svg.ed-svg-content-responsive");
  var svgHeight = svg.style("height");
  d3.selectAll('.ed-svg-container').style('height',svgHeight)
}
